<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>도서 등록</title>
  <link rel="stylesheet" href="css/form.css">
</head>
<body>
<div class="form-container">
  <form id="bookForm" class="form-grid">
    <div class="form-group">
      <label for="title">제목</label>
      <input type="text" id="title" name="title">
    </div>
    <div class="form-group">
      <label for="author">저자</label>
      <input type="text" id="author" name="author">
    </div>
    <div class="form-group">
      <label for="price">가격</label>
      <input type="number" id="price" name="price">
    </div>
    <button type="submit">등록</button>
  </form>
</div>

<script>
  // 전역 변수
  const API_BASE_URL = "http://localhost:8080";

  // DOM 엘리먼트 가져오기
  const bookForm = document.getElementById("bookForm");

  // Document Load 이벤트 처리
  document.addEventListener("DOMContentLoaded", function () {
    console.log("도서 등록 페이지 로드 완료");
  });

  // BookForm의 Submit 이벤트 처리
  bookForm.addEventListener("submit", function (event) {
    event.preventDefault(); // 기본 제출 동작 방지
    console.log("도서 등록 폼 제출됨");

    // FormData 객체 생성
    const formData = new FormData(bookForm);
    formData.forEach((value, key) => {
      console.log(`${key} = ${value}`);
    });

    // 사용자 정의 Book 객체 생성
    const bookData = {
      title: formData.get("title").trim(),
      author: formData.get("author").trim(),
      price: parseInt(formData.get("price")),
    };

    // 서버로 POST 요청 보내기
    fetch(`${API_BASE_URL}/books`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(bookData),
    })
            .then(response => {
              if (!response.ok) {
                throw new Error("도서 등록 실패");
              }
              return response.json();
            })
            .then(data => {
              console.log("등록 성공:", data);
              alert("도서가 성공적으로 등록되었습니다!");
              bookForm.reset(); // 폼 초기화
            })
            .catch(error => {
              console.error("에러 발생:", error);
              alert("도서 등록 중 오류가 발생했습니다.");
            });
  });
</script>
</body>
</html>
